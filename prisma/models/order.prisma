// 订单表
model Order {
    id                   Int       @id @default(autoincrement()) // 内部主键
    orderCode            String    @unique // 系统生成的订单编号
    externalOrderId      String? // 外部平台订单编号
    productId            Int? // 产品ID（外键）
    productName          String? // 产品标题（冗余存储）
    customerEmail        String? // 用户邮箱
    userId               String? // 用户ID（外键）
    currentOwnerId       String? // 当前负责人（系统用户ID）
    financialCloserId    String? // 财务结单人（系统用户ID）
    financialClosedAt    DateTime? // 财务结单时间
    financialClosed      Boolean   @default(false) // 是否财务结单
    amountPaid           Decimal?  @db.Decimal(10, 2) // 实际支付金额
    currency             String? // 币种 (CNY, USD)
    amountPaidCny        Decimal?  @db.Decimal(10, 2) // 折算后的人民币金额
    paidAt               DateTime? // 支付时间
    effectiveDate        DateTime? @db.Date // 生效时间
    benefitStartDate     DateTime? @db.Date // 权益开始时间
    benefitDurationDays  Int? // 权益时长（天）
    activeDays           Int? // 在籍时长（天）
    benefitDaysRemaining Int? // 权益剩余时间（天）

    // 关联关系
    product         Product?      @relation(fields: [productId], references: [id])
    user            User?         @relation("UserOrders", fields: [userId], references: [id])
    currentOwner    User?         @relation("CurrentOwnerOrders", fields: [currentOwnerId], references: [id])
    financialCloser User?         @relation("FinancialCloserOrders", fields: [financialCloserId], references: [id])
    refunds         OrderRefund[] // 订单的退款记录

    createdAt DateTime @default(now()) // 创建时间
    updatedAt DateTime @updatedAt // 更新时间
}
